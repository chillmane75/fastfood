<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>FOH</title>
<style>
body {
  background:#111;
  color:white;
  font-family:Arial, sans-serif;
  text-align:center;
  padding:40px;
}
.num { font-size:90px; color:#00ff99; margin:20px 0; }
.status { font-size:24px; margin-bottom:20px; }
select, textarea { width:80%; font-size:18px; padding:10px; margin-top:10px; }
button {
  font-size:26px;
  padding:15px 35px;
  margin-top:20px;
  border:none;
  border-radius:10px;
  background:#00ff99;
  cursor:pointer;
}
.undo { background:#ffcc00; color:black; }
</style>
</head>
<body>

<h1>FOH</h1>
<div class="status" id="status">Status: ‚Äì</div>
<div class="num" id="num">‚Äì</div>

<select id="dish"></select><br><br>

<label><input type="checkbox" id="allergy"> ‚ö†Ô∏è ALLERGI</label><br><br>
<textarea id="note" placeholder="Notat‚Ä¶"></textarea><br>

<button onclick="newOrder()">NY ORDRE</button><br>
<button class="undo" onclick="undoLast()">‚Ü©Ô∏è UNDO</button>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyBpCwh0JIuJphlEyCQTxhDOIdGm9fP5cg4",
  databaseURL: "https://the-shit-3bfd8-default-rtdb.europe-west1.firebasedatabase.app"
};
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let menu = {};
let lastOrderId = null;
let lastDishId = null;

db.ref("menu").on("value", snap => {
  const sel = document.getElementById("dish");
  sel.innerHTML = "";
  menu = {};

  snap.forEach(child => {
    const d = child.val();
    const left = d.max - d.sold;
    menu[child.key] = d;

    let status = "üü¢ Tilgjengelig";
    if (left <= 0) status = "üî¥ Utsolgt";
    else if (left <= 3) status = "üü° F√• igjen";

    const opt = document.createElement("option");
    opt.value = child.key;
    opt.text = `${d.name} ‚Äì ${status}`;
    opt.disabled = left <= 0;
    sel.appendChild(opt);
  });
});

function newOrder() {
  const dishId = dish.value;
  const dish = menu[dishId];
  if (!dish) return;

  db.ref("lastNumber").transaction(n => (n || 0) + 1, (err, ok, snap) => {
    if (!ok) return;
    const num = snap.val();

    db.ref("orders/" + num).set({
      dish: dish.name,
      allergy: allergy.checked,
      note: note.value,
      time: Date.now()
    });

    db.ref("menu/" + dishId + "/sold").transaction(n => (n || 0) + 1);

    lastOrderId = num;
    lastDishId = dishId;

    numEl.innerText = num;
    allergy.checked = false;
    note.value = "";
  });
}

function undoLast() {
  if (!lastOrderId) return alert("Ingen ordre √• angre");
  db.ref("orders/" + lastOrderId).remove();
  db.ref("menu/" + lastDishId + "/sold")
    .transaction(n => Math.max((n || 1) - 1, 0));
  lastOrderId = null;
  lastDishId = null;
}

db.ref("orders").on("value", snap => {
  const c = snap.numChildren();
  let s = "üü¢ Rolig";
  if (c >= 4) s = "üü° K√∏";
  if (c >= 7) s = "üî¥ Rush";
  status.innerText = "Status: " + s;
});
</script>
</body>
</html>
